# plan_0001 - Graph Migration Phase C & D Implementation Plan

## Goal

- 도메인별 Cypher 쿼리를 구현하고(Phase C), 기존 리포지토리 및 API를 Cypher 기반으로 전환(Phase D)하여 그래프 중심 아키텍처를 완성합니다.

## Scope

- In: `src/state_db/Query/CYPHER`, `src/state_db/repositories`, `src/state_db/graph`
- Out: SQL 기반 관계 테이블 로직

## Implementation Plan

- Step 1: 인벤토리 및 관계 조작을 위한 Cypher 쿼리 전수 구현 (inventory/earn_item.cypher 등)
- Step 2: `EntityRepository` 및 `PlayerRepository` 내 관계 조작 메서드들을 `CypherEngine` 사용으로 교체
- Step 3: API 응답 모델과 `ResultMapper` 결과의 정렬 및 매핑 보강

## Unit Test Plan (must)

- What to test: Cypher 쿼리 실행 결과의 정확성 및 리포지토리 메서드 연동
- Test cases: `tests/test_inventory_cypher.py`, `tests/test_relation_cypher.py`
- Command:
  - uv run pytest tests

## E2E Plan (must)

- Scenario: 플레이어 세션 생성 -> 아이템 획득 -> NPC 호감도 변경 -> 최종 상태 그래프 조회
- Expected: 그래프 노드와 엣지가 의도한 속성값을 가지고 유지됨
- How to run: `bin/project run` 후 API 호출 테스트
- Validation: AGE `MATCH` 쿼리로 데이터 확인

## Done Criteria

- [x] implementation completed
- [x] unit tests added/updated and passing
- [x] e2e executed and passing
- [x] docs updated if needed
