# plan_0003 - ScenarioRepository Cypher Conversion

## Goal

- 시나리오 진행(Act/Sequence 전환) 로직을 Cypher로 전환하여 진행 상태와 엔티티 관계를 그래프 상에서 통합 관리합니다.

## Scope

- In: `src/state_db/repositories/scenario.py`
- Out: 시나리오 진행 관련 SQL 쿼리

## Implementation Plan

- Step 1: `advance_act`, `update_sequence` 등을 위한 Cypher 로직 설계
- Step 2: 리포지토리 내 SQL 호출부를 `CypherEngine` 호출로 교체
- Step 3: 세션 복제 시 시나리오 상태 연동 로직 검증

## Unit Test Plan (must)

- What to test: 액트 전환 시 관련 엔티티들의 그래프 엣지(active 상태 등)가 동기화되는지 확인
- Test cases: `tests/test_router_SCENARIO.py`
- Command:
  - uv run pytest tests

## E2E Plan (must)

- Scenario: 시나리오 시작 -> 시퀀스 진행 -> 다음 액트로 이동
- Expected: 그래프 상의 `current_act`, `current_sequence` 노드/속성 갱신
- How to run: `bin/project run` 및 시나리오 시뮬레이션
- Validation: 통합 테스트 API 활용

## Done Criteria

- [x] implementation completed
- [x] unit tests added/updated and passing
- [x] e2e executed and passing
- [x] docs updated if needed
