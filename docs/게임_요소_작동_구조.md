# ê²Œì„ ìš”ì†Œ ì‘ë™ êµ¬ì¡° ë° ì¢…ì† ê´€ê³„

## ğŸ“Š ì „ì²´ ê³„ì¸µ êµ¬ì¡°

```
DB (FIRST/)
  â†“
Session (ì„¸ì…˜ ì‹œì‘)
  â”œâ”€â”€ Player (í”Œë ˆì´ì–´)
  â”‚   â”œâ”€â”€ Inventory (ì¸ë²¤í† ë¦¬)
  â”‚   â”œâ”€â”€ Player-NPC Relations (í˜¸ê°ë„)
  â”‚   â””â”€â”€ Player Stats (ìŠ¤íƒ¯)
  â”œâ”€â”€ NPC (NPC ì—”í‹°í‹°ë“¤)
  â”œâ”€â”€ Enemy (ì  ì—”í‹°í‹°ë“¤)
  â”œâ”€â”€ Act (ë§‰)
  â”‚   â””â”€â”€ Sequence (ì‹œí€€ìŠ¤)
  â”œâ”€â”€ Phase (í˜ì´ì¦ˆ)
  â””â”€â”€ Turn (í„´)
```

---

## ğŸ® 1. Session (ì„¸ì…˜) - ìµœìƒìœ„ ì»¨í…Œì´ë„ˆ

### ì‹œì‘ ì‹œ ìƒì„±ë˜ëŠ” ê²ƒë“¤
```
Session ìƒì„± ì‹œ ìë™ ìƒì„±:
â”œâ”€â”€ Player (í”Œë ˆì´ì–´ 1ëª…, í•„ìˆ˜)
â”œâ”€â”€ NPCë“¤ (ì‹œë‚˜ë¦¬ì˜¤ì— ì •ì˜ëœ ì´ˆê¸° NPC)
â”œâ”€â”€ Enemyë“¤ (ì‹œë‚˜ë¦¬ì˜¤ì— ì •ì˜ëœ ì´ˆê¸° ì )
â”œâ”€â”€ Player Inventory (í”Œë ˆì´ì–´ ì¸ë²¤í† ë¦¬, ì´ˆê¸° ì•„ì´í…œ í¬í•¨)
â”œâ”€â”€ Act = 1 (ì²« ë²ˆì§¸ ë§‰)
â”œâ”€â”€ Sequence = 1 (ì²« ë²ˆì§¸ ì‹œí€€ìŠ¤)
â”œâ”€â”€ Phase = "exploration" (ì´ˆê¸° í˜ì´ì¦ˆ, ì‹œë‚˜ë¦¬ì˜¤ë§ˆë‹¤ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ)
â””â”€â”€ Turn = 1 (ì²« ë²ˆì§¸ í„´)
```

### Sessionì´ ê´€ë¦¬í•˜ëŠ” ë©”íƒ€ ì •ë³´
- **session_id**: ê³ ìœ  ì„¸ì…˜ ì‹ë³„ì
- **scenario_id**: ì–´ë–¤ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í”Œë ˆì´ ì¤‘ì¸ì§€
- **status**: `active` | `paused` | `ended`
- **current_act**: í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ë§‰
- **current_sequence**: í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ì‹œí€€ìŠ¤
- **current_phase**: í˜„ì¬ í˜ì´ì¦ˆ (`combat`, `exploration`, `dialogue`, `rest`)
- **current_turn**: í˜„ì¬ í„´ ë²ˆí˜¸
- **current_location**: í˜„ì¬ ìœ„ì¹˜

### Session ìƒëª…ì£¼ê¸°
```
ìƒì„± (START_by_session/) 
  â†’ í™œì„± ìƒíƒœ (status: active)
  â†’ ì¼ì‹œì •ì§€ (MANAGE/session/pause_session.sql)
  â†’ ì¬ê°œ (MANAGE/session/resume_session.sql)
  â†’ ì¢…ë£Œ (MANAGE/session/end_session.sql)
```

### ì‹¤í–‰ ìˆœì„œ
```sql
-- 1. DB ì´ˆê¸° êµ¬ì„± (ìµœì´ˆ 1íšŒë§Œ)
FIRST/session.sql
FIRST/player.sql
FIRST/npc.sql
FIRST/enemy.sql
FIRST/item.sql
FIRST/inventory.sql
FIRST/player_inventory.sql
FIRST/player_npc_relations.sql
FIRST/scenario.sql
FIRST/phase_history.sql
FIRST/turn_history.sql

-- 2. ì„¸ì…˜ ì‹œì‘ (session_start() í˜¸ì¶œ ì‹œ)
START_by_session/C_session.sql          -- ì„¸ì…˜ ë ˆì½”ë“œ ìƒì„±
START_by_session/N_player.sql           -- í”Œë ˆì´ì–´ ìƒì„±
START_by_session/N_npc.sql              -- ì´ˆê¸° NPC ìƒì„±
START_by_session/N_enemy.sql            -- ì´ˆê¸° Enemy ìƒì„±
START_by_session/E_player_inventory.sql -- ì¸ë²¤í† ë¦¬ ì´ˆê¸°í™”
```

---

## ğŸ‘¤ 2. Player (í”Œë ˆì´ì–´) - Sessionì— ì¢…ì†

### Playerê°€ ì†Œìœ /ê´€ë¦¬í•˜ëŠ” ê²ƒë“¤
```
Player
â”œâ”€â”€ Stats (ìŠ¤íƒ¯)
â”‚   â”œâ”€â”€ hp (ì²´ë ¥)
â”‚   â”œâ”€â”€ max_hp (ìµœëŒ€ ì²´ë ¥)
â”‚   â”œâ”€â”€ attack (ê³µê²©ë ¥)
â”‚   â”œâ”€â”€ defense (ë°©ì–´ë ¥)
â”‚   â””â”€â”€ state (JSONB, ë™ì  ìŠ¤íƒ¯)
â”œâ”€â”€ Inventory (ì¸ë²¤í† ë¦¬)
â”‚   â””â”€â”€ Itemë“¤ (ì•„ì´í…œ ëª©ë¡ + ìˆ˜ëŸ‰)
â””â”€â”€ NPC Relations (NPC í˜¸ê°ë„)
    â””â”€â”€ NPCë³„ affinity ê°’
```

### Player ì¢…ì† ê´€ê³„
- **ìƒìœ„**: Session (session_idë¡œ ì—°ê²°)
- **í•˜ìœ„**: 
  - Inventory (player_idë¡œ ì—°ê²°)
  - Player-NPC Relations (player_idë¡œ ì—°ê²°)

### Player ìƒíƒœ ë³€ê²½
```python
# HP ë³€ê²½
UPDATE/update_player_hp.sql
- í”Œë ˆì´ì–´ HP ì¦ê°
- ì´ìœ (reason) ê¸°ë¡: "combat", "healing", "trap" ë“±

# ìŠ¤íƒ¯ ë³€ê²½
UPDATE/update_player_stats.sql
- ì—¬ëŸ¬ ìŠ¤íƒ¯ì„ í•œ ë²ˆì— ë³€ê²½ ê°€ëŠ¥
- JSONB state í•„ë“œ ì—…ë°ì´íŠ¸

# ìœ„ì¹˜ ë³€ê²½
UPDATE/update_location.sql
- Sessionì˜ current_location ë³€ê²½
- í”Œë ˆì´ì–´ê°€ ì´ë™í•˜ë©´ Session ìœ„ì¹˜ë„ ë³€ê²½ë¨
```

### Playerì™€ ì•„ì´í…œ
```python
# ì•„ì´í…œ íšë“
UPDATE/earn_item.sql
- player_inventoryì— ì•„ì´í…œ ì¶”ê°€
- ì´ë¯¸ ìˆìœ¼ë©´ ìˆ˜ëŸ‰ ì¦ê°€

# ì•„ì´í…œ ì‚¬ìš©
UPDATE/use_item.sql
- ìˆ˜ëŸ‰ ê°ì†Œ
- íš¨ê³¼ ì ìš© (HP íšŒë³µ ë“±)
```

### Playerì™€ NPC
```python
# í˜¸ê°ë„ ë³€ê²½
UPDATE/update_npc_affinity.sql
- player_npc_relations í…Œì´ë¸” ì—…ë°ì´íŠ¸
- affinity ê°’ ì¦ê°

# í˜¸ê°ë„ ì¡°íšŒ
INQUIRY/Npc_relations.sql
- í”Œë ˆì´ì–´ì˜ ëª¨ë“  NPC í˜¸ê°ë„ ì¡°íšŒ
```

---

## ğŸ¤– 3. NPC (Non-Player Character) - Sessionì— ì¢…ì†

### NPC ì†ì„±
```
NPC
â”œâ”€â”€ npc_id (ë§ˆìŠ¤í„° ë°ì´í„° ID)
â”œâ”€â”€ npc_instance_id (ì„¸ì…˜ ë‚´ ì¸ìŠ¤í„´ìŠ¤ ID)
â”œâ”€â”€ session_id (ì–´ëŠ ì„¸ì…˜ì— ì†í•˜ëŠ”ì§€)
â”œâ”€â”€ name (ì´ë¦„)
â”œâ”€â”€ role (ì—­í• )
â”œâ”€â”€ state (JSONB, ë™ì  ìƒíƒœ)
â”œâ”€â”€ is_active (í™œì„± ì—¬ë¶€)
â””â”€â”€ affinity with Player (í”Œë ˆì´ì–´ì™€ì˜ í˜¸ê°ë„, player_npc_relations)
```

### NPC ìƒëª…ì£¼ê¸°
```
ìƒì„± ë°©ë²•:
1. ì„¸ì…˜ ì‹œì‘ ì‹œ ìë™ ìƒì„± (START_by_session/N_npc.sql)
2. ê²Œì„ ì§„í–‰ ì¤‘ ë™ì  ìƒì„± (MANAGE/npc/spawn_npc.sql)

ì œê±°:
- MANAGE/npc/remove_npc.sql
- is_activeë¥¼ falseë¡œ ë³€ê²½ (soft delete)
```

### NPC ì¢…ì† ê´€ê³„
- **ìƒìœ„**: Session (session_idë¡œ ì—°ê²°)
- **ê´€ê³„**: Player (player_npc_relationsë¡œ ì—°ê²°)

### NPC ì¡°íšŒ
```python
# ì„¸ì…˜ì˜ ëª¨ë“  NPC
INQUIRY/Session_npc.sql
- session_idë¡œ NPC ëª©ë¡ ì¡°íšŒ
- is_active=trueì¸ NPCë§Œ (ê¸°ë³¸)

# í”Œë ˆì´ì–´ì™€ì˜ ê´€ê³„
INQUIRY/Npc_relations.sql
- íŠ¹ì • í”Œë ˆì´ì–´ì˜ ëª¨ë“  NPC í˜¸ê°ë„
```

---

## ğŸ‘¹ 4. Enemy (ì ) - Sessionì— ì¢…ì†

### Enemy ì†ì„±
```
Enemy
â”œâ”€â”€ enemy_id (ë§ˆìŠ¤í„° ë°ì´í„° ID)
â”œâ”€â”€ enemy_instance_id (ì„¸ì…˜ ë‚´ ì¸ìŠ¤í„´ìŠ¤ ID)
â”œâ”€â”€ session_id (ì–´ëŠ ì„¸ì…˜ì— ì†í•˜ëŠ”ì§€)
â”œâ”€â”€ name (ì´ë¦„)
â”œâ”€â”€ hp (í˜„ì¬ ì²´ë ¥)
â”œâ”€â”€ max_hp (ìµœëŒ€ ì²´ë ¥)
â”œâ”€â”€ attack (ê³µê²©ë ¥)
â”œâ”€â”€ defense (ë°©ì–´ë ¥)
â”œâ”€â”€ state (JSONB, ë™ì  ìƒíƒœ)
â””â”€â”€ is_active (í™œì„± ì—¬ë¶€, ìƒì¡´ ì—¬ë¶€)
```

### Enemy ìƒëª…ì£¼ê¸°
```
ìƒì„± ë°©ë²•:
1. ì„¸ì…˜ ì‹œì‘ ì‹œ ìë™ ìƒì„± (START_by_session/N_enemy.sql)
2. ê²Œì„ ì§„í–‰ ì¤‘ ë™ì  ìƒì„± (MANAGE/enemy/spawn_enemy.sql)
   - ì˜ˆ: íŠ¹ì • ìœ„ì¹˜ ë„ë‹¬ ì‹œ ì  ìŠ¤í°
   - ì˜ˆ: íŠ¹ì • ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±° ì‹œ ë³´ìŠ¤ ë“±ì¥

ì œê±°/ì²˜ì¹˜:
1. UPDATE/defeated_enemy.sql
   - is_activeë¥¼ falseë¡œ ë³€ê²½
   - ë³´ìƒ ì²˜ë¦¬ ê°€ëŠ¥
2. MANAGE/enemy/remove_enemy.sql
   - ê°•ì œ ì œê±° (GM ëª…ë ¹)
```

### Enemy ì¢…ì† ê´€ê³„
- **ìƒìœ„**: Session (session_idë¡œ ì—°ê²°)
- **ìƒí˜¸ì‘ìš©**: Player (ì „íˆ¬ ì‹œ)

### Enemy ìƒíƒœ ë³€ê²½
```python
# HP ë³€ê²½
UPDATE/update_enemy_hp.sql
- ì  HP ì¦ê°
- ì „íˆ¬ ë¡œê·¸ ê¸°ë¡

# ì  ì²˜ì¹˜
UPDATE/defeated_enemy.sql
- is_activeë¥¼ falseë¡œ ë³€ê²½
- ê²½í—˜ì¹˜/ë³´ìƒ ì²˜ë¦¬ ê°€ëŠ¥
```

### Enemy ì¡°íšŒ
```python
# ì„¸ì…˜ì˜ ëª¨ë“  ì 
INQUIRY/Session_enemy.sql
- session_idë¡œ ì  ëª©ë¡ ì¡°íšŒ
- active_only ì˜µì…˜: is_active=trueì¸ ì ë§Œ
```

---

## ğŸ­ 5. Act & Sequence - Sessionì— ì¢…ì†

### ê³„ì¸µ êµ¬ì¡°
```
Session
â””â”€â”€ Act (ë§‰)
    â””â”€â”€ Sequence (ì‹œí€€ìŠ¤)
        â””â”€â”€ [ì—¬ëŸ¬ Turnê³¼ Phaseê°€ ì§„í–‰ë¨]
```

### Act (ë§‰)
- ê²Œì„ì˜ í° ì±•í„° ë‹¨ìœ„
- ì˜ˆ: Act 1 = íŠœí† ë¦¬ì–¼, Act 2 = ë³¸ ìŠ¤í† ë¦¬, Act 3 = ì—”ë”©
- Sessionì˜ `current_act`ì— ì €ì¥

### Sequence (ì‹œí€€ìŠ¤)
- Act ë‚´ì˜ ì‘ì€ ì¥ë©´/ì´ë²¤íŠ¸ ë‹¨ìœ„
- ì˜ˆ: Sequence 1 = ë§ˆì„ ë„ì°©, Sequence 2 = ìƒì  ë°©ë¬¸, Sequence 3 = ì „íˆ¬
- Sessionì˜ `current_sequence`ì— ì €ì¥
- `limit_sequence.sql`ë¡œ ì œí•œ í™•ì¸ ê°€ëŠ¥

### ê´€ë¦¬
```python
# Act ê´€ë¦¬
MANAGE/act/select_act.sql     # Act ì§ì ‘ ì§€ì • (GM)
MANAGE/act/add_act.sql        # Act ì¦ê°€
MANAGE/act/back_act.sql       # Act ë¡¤ë°±
MANAGE/act/act_check.sql      # í˜„ì¬ Act í™•ì¸

# Sequence ê´€ë¦¬
MANAGE/sequence/select_sequence.sql  # Sequence ì§ì ‘ ì§€ì •
MANAGE/sequence/add_sequence.sql     # Sequence ì¦ê°€
MANAGE/sequence/back_sequence.sql    # Sequence ë¡¤ë°±
MANAGE/sequence/limit_sequence.sql   # Sequence ì œí•œ í™•ì¸

# ì¡°íšŒ
INQUIRY/Act_now.sql          # í˜„ì¬ Act
INQUIRY/Sequence_now.sql     # í˜„ì¬ Sequence
```

---

## âš”ï¸ 6. Phase (í˜ì´ì¦ˆ) - Sessionì— ì¢…ì†

### Phase íƒ€ì…
```
Phase ì¢…ë¥˜ (ENUM):
â”œâ”€â”€ combat        # ì „íˆ¬
â”œâ”€â”€ exploration   # íƒìƒ‰
â”œâ”€â”€ dialogue      # ëŒ€í™”
â””â”€â”€ rest          # íœ´ì‹
```

### Phase ì „í™˜
- Sessionì˜ `current_phase`ì— ì €ì¥
- Phase ì „í™˜ ì‹œ `phase_history`ì— ê¸°ë¡

### Phaseë³„ í—ˆìš© í–‰ë™
```
combat:
  - ê³µê²©, ë°©ì–´, ìŠ¤í‚¬ ì‚¬ìš©, ì•„ì´í…œ ì‚¬ìš©
  - UPDATE/phase/combat_phase.sql

exploration:
  - ì´ë™, ì¡°ì‚¬, ì•„ì´í…œ íšë“
  - UPDATE/phase/exploration_phase.sql

dialogue:
  - ëŒ€í™” ì„ íƒ, í˜¸ê°ë„ ë³€ê²½
  - UPDATE/phase/dialogue_phase.sql

rest:
  - HP íšŒë³µ, ì¸ë²¤í† ë¦¬ ì •ë¦¬
  - UPDATE/phase/rest_phase.sql
```

### Phase ê´€ë¦¬
```python
# Phase ì „í™˜
MANAGE/phase/change_phase.sql
- í˜„ì¬ phase ë³€ê²½
- phase_historyì— ê¸°ë¡

# Phase í™•ì¸
MANAGE/phase/phase_check.sql
- í˜„ì¬ Phase ì¡°íšŒ

# í–‰ë™ í—ˆìš© ê²€ì¦
MANAGE/phase/is_action_allowed.sql
- íŠ¹ì • í–‰ë™ì´ í˜„ì¬ Phaseì—ì„œ ê°€ëŠ¥í•œì§€ í™•ì¸
```

### Phase íˆìŠ¤í† ë¦¬ ì¶”ì 
```python
TRACE/phase_tracing.sql (700ì¤„+)
- Phase ì „í™˜ ì´ë ¥
- ê° Phase ì†Œìš” ì‹œê°„
- Phaseë³„ í†µê³„
- íŒ¨í„´ ë¶„ì„
```

---

## ğŸ”„ 7. Turn (í„´) - Sessionì— ì¢…ì†

### Turn ê°œë…
- ê²Œì„ ì§„í–‰ì˜ ìµœì†Œ ë‹¨ìœ„
- Sessionì˜ `current_turn`ì— ì €ì¥
- Turn ë³€ê²½ ì‹œ `turn_history`ì— ê¸°ë¡

### Turn ê´€ë¦¬
```python
# Turn ì¦ê°€
MANAGE/turn/add_turn.sql
- current_turn += 1
- turn_historyì— ê¸°ë¡

# Turn ë³€ê²½ í™•ì¸
MANAGE/turn/turn_changed.sql
- Turnì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
```

### Turn íˆìŠ¤í† ë¦¬ ì¶”ì 
```python
TRACE/turn_tracing.sql (900ì¤„+)
- Turnë³„ ì´ë²¤íŠ¸ ì´ë ¥
- ê° Turn ì†Œìš” ì‹œê°„
- Turnë³„ í†µê³„
- ì´ìƒ íŒ¨í„´ íƒì§€
- ë¦¬í”Œë ˆì´ ê¸°ëŠ¥
```

---

## ğŸ“¦ 8. Inventory & Item - Playerì— ì¢…ì†

### êµ¬ì¡°
```
Item (ë§ˆìŠ¤í„° ë°ì´í„°)
â””â”€â”€ Player Inventory (í”Œë ˆì´ì–´ë³„ ì¸ìŠ¤í„´ìŠ¤)
    â”œâ”€â”€ item_id
    â”œâ”€â”€ quantity (ìˆ˜ëŸ‰)
    â””â”€â”€ player_id
```

### Item ì†ì„±
- **item_id**: ì•„ì´í…œ ê³ ìœ  ID
- **name**: ì•„ì´í…œ ì´ë¦„
- **type**: ì•„ì´í…œ ì¢…ë¥˜ (`consumable`, `equipment`, `quest`, `misc`)
- **effect**: íš¨ê³¼ (JSONB)
- **description**: ì„¤ëª…

### Inventory ê´€ë¦¬
```python
# ì¸ë²¤í† ë¦¬ ì¡°íšŒ
INQUIRY/Session_inventory.sql
- session_idë¡œ í”Œë ˆì´ì–´ ì¸ë²¤í† ë¦¬ ì¡°íšŒ
- ì•„ì´í…œ ì´ë¦„, ìˆ˜ëŸ‰, íš¨ê³¼ ë“± í¬í•¨

# ì•„ì´í…œ íšë“
UPDATE/earn_item.sql
- player_inventoryì— ì¶”ê°€
- ì´ë¯¸ ìˆìœ¼ë©´ quantity ì¦ê°€

# ì•„ì´í…œ ì‚¬ìš©
UPDATE/use_item.sql
- quantity ê°ì†Œ
- íš¨ê³¼ ì ìš© (ì˜ˆ: HP íšŒë³µ)
- quantityê°€ 0ì´ ë˜ë©´ ìë™ ì‚­ì œ
```

---

## ğŸ—ºï¸ 9. Location (ìœ„ì¹˜) - Sessionì— ì¢…ì†

### ìœ„ì¹˜ ì •ë³´
- Sessionì˜ `current_location`ì— ì €ì¥
- ìœ„ì¹˜ ë³€ê²½ ì‹œ Session ë ˆì½”ë“œ ì—…ë°ì´íŠ¸

### ìœ„ì¹˜ ê´€ë¦¬
```python
# ìœ„ì¹˜ ë³€ê²½
UPDATE/update_location.sql
- Sessionì˜ current_location ì—…ë°ì´íŠ¸

# ìœ„ì¹˜ ì¡°íšŒ
INQUIRY/Location_now.sql
- í˜„ì¬ ìœ„ì¹˜ ì¡°íšŒ

# ìœ„ì¹˜ ë³€ê²½ (MANAGE)
MANAGE/location/location_change.sql
- ê°•ì œ ìœ„ì¹˜ ë³€ê²½ (GM ëª…ë ¹)
- UPDATE ì‚¬ìš© ê¶Œì¥
```

---

## ğŸ“Š ì „ì²´ ì‘ë™ íë¦„

### 1ï¸âƒ£ ì„¸ì…˜ ì‹œì‘ (`session_start()`)
```
1. FIRST/ ì‹¤í–‰ (ìµœì´ˆ 1íšŒ, í…Œì´ë¸” ìƒì„±)
   â”œâ”€â”€ session.sql
   â”œâ”€â”€ player.sql
   â”œâ”€â”€ npc.sql
   â”œâ”€â”€ enemy.sql
   â”œâ”€â”€ item.sql
   â”œâ”€â”€ inventory.sql
   â”œâ”€â”€ player_inventory.sql
   â”œâ”€â”€ player_npc_relations.sql
   â””â”€â”€ ...

2. START_by_session/ ì‹¤í–‰ (ì„¸ì…˜ë§ˆë‹¤)
   â”œâ”€â”€ C_session.sql          â†’ Session ìƒì„±
   â”œâ”€â”€ N_player.sql           â†’ Player ìƒì„±
   â”œâ”€â”€ N_npc.sql              â†’ ì´ˆê¸° NPC ìƒì„±
   â”œâ”€â”€ N_enemy.sql            â†’ ì´ˆê¸° Enemy ìƒì„±
   â””â”€â”€ E_player_inventory.sql â†’ ì´ˆê¸° ì•„ì´í…œ ì§€ê¸‰

3. Session ì´ˆê¸° ìƒíƒœ
   â”œâ”€â”€ status = "active"
   â”œâ”€â”€ current_act = 1
   â”œâ”€â”€ current_sequence = 1
   â”œâ”€â”€ current_phase = "exploration" (ì‹œë‚˜ë¦¬ì˜¤ë§ˆë‹¤ ë‹¤ë¦„)
   â”œâ”€â”€ current_turn = 1
   â””â”€â”€ current_location = "starting_area" (ì‹œë‚˜ë¦¬ì˜¤ë§ˆë‹¤ ë‹¤ë¦„)
```

### 2ï¸âƒ£ ê²Œì„ í”Œë ˆì´ ë£¨í”„
```
[í”Œë ˆì´ì–´ í–‰ë™ ì…ë ¥]
  â†“
[INQUIRY/ í˜„ì¬ ìƒíƒœ ì¡°íšŒ]
  â”œâ”€â”€ Session_show.sql         (ì„¸ì…˜ ì •ë³´)
  â”œâ”€â”€ Session_inventory.sql    (ì¸ë²¤í† ë¦¬)
  â”œâ”€â”€ Session_npc.sql          (NPC ëª©ë¡)
  â”œâ”€â”€ Session_enemy.sql        (ì  ëª©ë¡)
  â””â”€â”€ Player_stats.sql         (í”Œë ˆì´ì–´ ìŠ¤íƒ¯)
  â†“
[RuleEngine íŒì •]
  - í–‰ë™ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
  - Phaseì— ë§ëŠ”ì§€ ê²€ì¦ (is_action_allowed.sql)
  â†“
[UPDATE/ ìƒíƒœ ë³€ê²½]
  â”œâ”€â”€ update_player_hp.sql     (HP ë³€ê²½)
  â”œâ”€â”€ update_enemy_hp.sql      (ì  HP ë³€ê²½)
  â”œâ”€â”€ earn_item.sql            (ì•„ì´í…œ íšë“)
  â”œâ”€â”€ use_item.sql             (ì•„ì´í…œ ì‚¬ìš©)
  â””â”€â”€ update_npc_affinity.sql  (í˜¸ê°ë„ ë³€ê²½)
  â†“
[MANAGE/ ë©”íƒ€ ê´€ë¦¬]
  â”œâ”€â”€ add_turn.sql             (Turn ì¦ê°€)
  â”œâ”€â”€ change_phase.sql         (Phase ì „í™˜)
  â”œâ”€â”€ spawn_enemy.sql          (ì  ìƒì„±)
  â””â”€â”€ remove_enemy.sql         (ì  ì œê±°)
  â†“
[TRACE/ íˆìŠ¤í† ë¦¬ ê¸°ë¡]
  â”œâ”€â”€ phase_history í…Œì´ë¸”
  â””â”€â”€ turn_history í…Œì´ë¸”
```

### 3ï¸âƒ£ Phaseë³„ ì²˜ë¦¬
```
Combat Phase:
  â”œâ”€â”€ UPDATE/phase/combat_phase.sql
  â”œâ”€â”€ í”Œë ˆì´ì–´/ì  HP ë³€ê²½
  â”œâ”€â”€ ì  ì²˜ì¹˜ ì‹œ defeated_enemy.sql
  â””â”€â”€ ì „íˆ¬ ì¢…ë£Œ ì‹œ Phase ì „í™˜

Exploration Phase:
  â”œâ”€â”€ UPDATE/phase/exploration_phase.sql
  â”œâ”€â”€ ìœ„ì¹˜ ë³€ê²½ (update_location.sql)
  â”œâ”€â”€ ì•„ì´í…œ íšë“ (earn_item.sql)
  â””â”€â”€ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±° ì‹œ Phase ì „í™˜

Dialogue Phase:
  â”œâ”€â”€ UPDATE/phase/dialogue_phase.sql
  â”œâ”€â”€ í˜¸ê°ë„ ë³€ê²½ (update_npc_affinity.sql)
  â””â”€â”€ ëŒ€í™” ì¢…ë£Œ ì‹œ Phase ì „í™˜

Rest Phase:
  â”œâ”€â”€ UPDATE/phase/rest_phase.sql
  â”œâ”€â”€ HP íšŒë³µ (update_player_hp.sql)
  â””â”€â”€ íœ´ì‹ ì¢…ë£Œ ì‹œ Phase ì „í™˜
```

---

## ğŸ”— ì¢…ì† ê´€ê³„ ìš”ì•½

```
Database (FIRST/)
  â”‚
  â””â”€ Session
      â”œâ”€ Player (1:1)
      â”‚   â”œâ”€ Inventory (1:N)
      â”‚   â”‚   â””â”€ Items (N:M via player_inventory)
      â”‚   â””â”€ NPC Relations (N:M via player_npc_relations)
      â”‚       â””â”€ NPCs
      â”‚
      â”œâ”€ NPCs (1:N)
      â”‚   â””â”€ is_active flag
      â”‚
      â”œâ”€ Enemies (1:N)
      â”‚   â””â”€ is_active flag
      â”‚
      â”œâ”€ Act (1:1)
      â”‚   â””â”€ Sequence (1:1)
      â”‚
      â”œâ”€ Phase (1:1)
      â”‚   â””â”€ Phase History (1:N)
      â”‚
      â”œâ”€ Turn (1:1)
      â”‚   â””â”€ Turn History (1:N)
      â”‚
      â””â”€ Location (1:1)
```

### ìƒì„±/ì†Œë©¸ ê´€ê³„
```
Session ìƒì„± ì‹œ:
  â†’ Player ìƒì„± (í•„ìˆ˜, 1ëª…)
  â†’ NPCs ìƒì„± (ì„ íƒ, 0~Nëª…)
  â†’ Enemies ìƒì„± (ì„ íƒ, 0~Nëª…)
  â†’ Inventory ì´ˆê¸°í™”
  â†’ Act, Sequence, Phase, Turn, Location ì´ˆê¸°í™”

Session ì¢…ë£Œ ì‹œ:
  â†’ ëª¨ë“  í•˜ìœ„ ì—”í‹°í‹°ëŠ” ìœ ì§€ (íˆìŠ¤í† ë¦¬ ë³´ì¡´)
  â†’ statusë¥¼ "ended"ë¡œ ë³€ê²½
  â†’ ë” ì´ìƒ ìˆ˜ì • ë¶ˆê°€
```

### ë™ì  ìƒì„±/ì œê±°
```
ê²Œì„ ì§„í–‰ ì¤‘:
  â”œâ”€ Enemy ë™ì  ìƒì„±/ì œê±° ê°€ëŠ¥
  â”‚   â”œâ”€ spawn_enemy.sql
  â”‚   â””â”€ remove_enemy.sql / defeated_enemy.sql
  â”‚
  â””â”€ NPC ë™ì  ìƒì„±/ì œê±° ê°€ëŠ¥
      â”œâ”€ spawn_npc.sql
      â””â”€ remove_npc.sql
```

---

## ğŸ’¡ í•µì‹¬ ì›ì¹™

1. **Sessionì´ ëª¨ë“  ê²ƒì˜ ì»¨í…Œì´ë„ˆ**
   - ëª¨ë“  ì—”í‹°í‹°ì™€ ìƒíƒœëŠ” Sessionì— ì¢…ì†

2. **PlayerëŠ” Sessionë‹¹ 1ëª…**
   - ë©€í‹°í”Œë ˆì´ì–´ëŠ” ì—¬ëŸ¬ Sessionìœ¼ë¡œ êµ¬í˜„

3. **NPC/EnemyëŠ” ë™ì **
   - ì‹œì‘ ì‹œ ìƒì„± + ê²Œì„ ì¤‘ ë™ì  ìƒì„±/ì œê±°

4. **PhaseëŠ” í–‰ë™ì„ ì œí•œ**
   - ê° Phaseë§ˆë‹¤ í—ˆìš©ë˜ëŠ” í–‰ë™ì´ ë‹¤ë¦„

5. **Turnì€ ì‹œê°„ì˜ íë¦„**
   - ëª¨ë“  í–‰ë™ì€ Turn ë‹¨ìœ„ë¡œ ê¸°ë¡

6. **Act/SequenceëŠ” ìŠ¤í† ë¦¬ ì§„í–‰**
   - ê²Œì„ì˜ í° íë¦„ì„ ê´€ë¦¬

7. **ëª¨ë“  ë³€ê²½ì€ íˆìŠ¤í† ë¦¬ì— ê¸°ë¡**
   - Phase/Turn ë³€ê²½ ì´ë ¥ ì¶”ì  ê°€ëŠ¥
   - ë””ë²„ê¹… ë° ë¶„ì„ì— í™œìš©

---

## ğŸ” ì¡°íšŒ íŒ¨í„´

### ì„¸ì…˜ ì „ì²´ ìƒíƒœ ì¡°íšŒ
```python
session_data = {
    "session": INQUIRY/Session_show.sql,
    "player": INQUIRY/Player_stats.sql,
    "inventory": INQUIRY/Session_inventory.sql,
    "npcs": INQUIRY/Session_npc.sql,
    "enemies": INQUIRY/Session_enemy.sql,
    "current_act": INQUIRY/Act_now.sql,
    "current_sequence": INQUIRY/Sequence_now.sql,
    "current_location": INQUIRY/Location_now.sql,
    "phase": INQUIRY/Session_phase.sql,
    "turn": INQUIRY/Session_turn.sql
}
```

### íˆìŠ¤í† ë¦¬ ì¡°íšŒ
```python
history_data = {
    "phase_history": TRACE/phase_tracing.sql,
    "turn_history": TRACE/turn_tracing.sql,
    "session_phases": DEBUG/H_Session_phase.sql,
    "session_turns": DEBUG/H_Session_turn.sql
}
```

---

## âš™ï¸ ì—…ë°ì´íŠ¸ íŒ¨í„´

### ì „íˆ¬ ì‹œë‚˜ë¦¬ì˜¤
```python
1. Phase í™•ì¸ (combatì¸ì§€)
2. í”Œë ˆì´ì–´ ê³µê²©
   - update_enemy_hp.sql (ì  HP ê°ì†Œ)
3. ì  ì²˜ì¹˜ í™•ì¸
   - defeated_enemy.sql (is_active = false)
4. ì  ë°˜ê²©
   - update_player_hp.sql (í”Œë ˆì´ì–´ HP ê°ì†Œ)
5. Turn ì¦ê°€
   - add_turn.sql
```

### ì•„ì´í…œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤
```python
1. ì¸ë²¤í† ë¦¬ í™•ì¸
   - Session_inventory.sql
2. ì•„ì´í…œ ì‚¬ìš©
   - use_item.sql (ìˆ˜ëŸ‰ ê°ì†Œ)
3. íš¨ê³¼ ì ìš©
   - update_player_hp.sql (HP íšŒë³µ)
```

### Phase ì „í™˜ ì‹œë‚˜ë¦¬ì˜¤
```python
1. í˜„ì¬ Phase í™•ì¸
   - Session_phase.sql
2. ì „í™˜ ì¡°ê±´ í™•ì¸
   - RuleEngine ë¡œì§
3. Phase ì „í™˜
   - change_phase.sql
4. íˆìŠ¤í† ë¦¬ ê¸°ë¡
   - phase_history ìë™ ê¸°ë¡
```

---

ì´ êµ¬ì¡°ë¥¼ í†µí•´ TRPG ê²Œì„ì˜ ëª¨ë“  ìƒíƒœì™€ ì§„í–‰ ìƒí™©ì„ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!
